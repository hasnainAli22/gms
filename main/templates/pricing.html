{% extends "base.html" %}
{% load static %}
{% load check_package %}
<!--filter low-->
{% load mathfilters %}
{% block content %}
  <link rel="stylesheet"
        type="text/css"
        href="{% static 'bootstrap-icons/font/bootstrap-icons.css' %}" />
  <!--Plans-->
  <section class="container my-4">
    <h1 class="text-center mb-4 section-heading border-bottom pb-2">Plans</h1>
    <div class="row">
      {% for plan in plans %}
        <div class="col-md-4 mb-3 d-flex align-items-stretch">
          <div class="card rounded-3 shadow-sm plan-min-width {% if plan.highlight_status %}border-primary{% endif %}">
            {% if plan.highlight_status %}
              <div class="card-header py-3 text-white bg-primary border-primary">
              {% else %}
                <div class="card-header py-3">
                {% endif %}
                <h4 class="my-0 fw-normal">{{ plan.title }}</h4>
              </div>
              <div class="card-body d-flex flex-column">
                <h1 class="card-title pricing-card-title">
                  ${{ plan.price }}
                  <small class="text-muted fw-light">/{{ plan.validity_days }} Days</small>
                </h1>
                <p class="text-success">Member Capacity {{ plan.max_member|sub:plan.total_members }}</p>
                <ul class="list-unstyled mt-3 mb-4">
                  {% for feature in plan.subplanfeature_set.all %}<li>{{ feature.title }}</li>{% endfor %}
                </ul>
                <p class="mt-auto">
                  {% if request.user.is_authenticated %}
                    <!--if1-->
                    {% check_user_package request.user.id plan.id as check_pckg %}
                    <!--check-->
                    {% check_pckg_validity request.user.id plan.id as check_valid %}
                    <!--check-->
                    {% if check_pckg %}
                      {% if check_valid %}
                        <a href="{% url 'checkout' plan.id %}"
                           class="w-100 btn btn-lg btn-outline-primary">Get started</a>
                      {% else %}
                        <a href="#" class="w-100 btn btn-lg btn-dark disabled">Purchased</a>
                      {% endif %}
                    {% else %}
                      <a href="{% url 'checkout' plan.id %}"
                         class="w-100 btn btn-lg btn-outline-primary mt-auto">Get started</a>
                    {% endif %}
                  {% else %}
                    <a href="{% url 'login' %}" class="w-100 btn btn-lg btn-outline-primary">Get started</a>
                  {% endif %}
                </p>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </section>
  <!--Plans Main-->
  <section class="container my-4">
    <h1 class="text-center mb-4 section-heading">Services</h1>
    <div class="row">
      {% for plan in plans %}
        <div class="col-md-4 mb-3 d-flex align-items-stretch">
          <div class="card">
            <div class="card-body d-flex flex-column">
              <h3 class="card-title">{{ plan.id }}</h3>
              <p class="card-text">{{ plan.subplanfeature_set.all }}</p>
              <a href="#" class="btn btn-primary mt-auto">Read More</a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </section>
  <h2 class="display-6 text-center mb-4">Compare plans</h2>
  <div class="table-responsive">
    <table class="table text-center">
      <thead>
        <tr>
          <th style="width: 34%"></th>
          {% for plan in plans %}
            <th style="width: 22%">{{ plan.title }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for feature in dfeatures %}
          <tr>
            <th scope="row" class="text-start">{{ feature.title }}</th>
            {% for plan in plans %}
              <td>
                {% if plan in feature.subplan.all %}
                  <i class="bi bi-check-lg"></i>
                {% else %}
                  <i class="bi bi-x-lg text-danger"></i>
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>
{% endblock content %}
